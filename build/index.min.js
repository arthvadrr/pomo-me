(function () {
    'use strict';

    /*
    # Complaints/ TODO Refactor
    ## Utilize state
    ## Refactor to class
    ## Purify functions
    ## MVC refactor. MVC can be fully deployed here
    */
    var $timer = document.getElementById("timer");
    var $start = document.getElementById("start");
    var $reset = document.getElementById("reset");
    var $increaseTime = document.getElementById("increaseTime");
    var $decreaseTime = document.getElementById("decreaseTime");
    var $progressBar = document.getElementById("progressBar");
    var isRunning = false;
    var dateStarted;
    var delta;
    var startHidden = false; //JS or linter bug resulting in type error. TODO Investigate why I'm having to explicitly force type inference.

    var countdown = function countdown() {};

    var originalTime = 3;
    var startTime = originalTime;
    var remainingTime = originalTime;

    var formatTime = function formatTime(seconds) {
      var formattedTime;
      var minutes = Math.floor(seconds / 60);
      var fseconds = seconds % 60;
      var fminutes = minutes % 60;

      if (minutes >= 60) {
        fminutes = 60;
        fseconds = 0;
      }

      var addLeadingZero = function addLeadingZero(_int) {
        return _int < 10 ? "0".concat(_int) : _int;
      };

      fseconds = addLeadingZero(fseconds);
      fminutes = addLeadingZero(fminutes);
      formattedTime = "".concat(fminutes, ":").concat(fseconds);
      return formattedTime;
    };

    var printTimer = function printTimer(print) {
      $timer.innerHTML = print;
      $progressBar.style.strokeDashoffset = updateStrokeDashArrayOffset();
    };

    var updateStrokeDashArrayOffset = function updateStrokeDashArrayOffset() {
      if (remainingTime !== 0) {
        var adjStart = originalTime - 1;
        var adjRemaining = remainingTime - 1;
        return 565.48 - 565.48 * adjRemaining / adjStart;
      }

      return 565.48;
    };

    var adjustTime = function adjustTime(delta) {
      var res = startTime - delta;

      if (res === 0) {
        delta = 0;
        return 0;
      }

      return startTime - delta;
    };

    var onReset = function onReset() {
      onStop();

      if (startHidden) {
        $start.removeAttribute("disabled", true);
      }

      isRunning = false;
      $start.innerHTML = "Start";
      $start.setAttribute("aria-pressed", false);
      startTime = originalTime;
      remainingTime = originalTime;
      printTimer(formatTime(remainingTime));
    };

    var onTimerZero = function onTimerZero() {
      startHidden = true;
      $start.setAttribute("disabled", true);
    };

    var onStop = function onStop() {
      isRunning = false;
      $start.innerHTML = "Start";
      $start.setAttribute("aria-pressed", false);
      clearInterval(countdown);

      if (remainingTime === 0) {
        onTimerZero();
      } else {
        startTime = remainingTime;
      }
    };

    var onStart = function onStart() {
      console.log("pressed");

      if (!isRunning) {
        isRunning = true;
        $start.innerHTML = "Pause";
        $start.setAttribute("aria-pressed", true);
        dateStarted = Date.now();
        countdown = setInterval(function () {
          delta = Math.round((Date.now() - dateStarted) / 1000);
          remainingTime = adjustTime(delta);
          printTimer(formatTime(remainingTime));

          if (remainingTime === 0) {
            onStop();
          }
        }, 10);
      } else if (remainingTime !== 0) {
        onStop();
      }
    };

    var onIncreaseTime = function onIncreaseTime() {
      isRunning = false;
      clearInterval(countdown);
      $start.innerHTML = "Start";
      $start.setAttribute("aria-pressed", false);

      if (startTime <= 3300) {
        startTime += 300;
      } else {
        startTime = 3600;
      }

      remainingTime = startTime;
      originalTime = startTime;
      printTimer(formatTime(startTime));
    };

    var onDecreaseTime = function onDecreaseTime() {
      isRunning = false;
      clearInterval(countdown);
      $start.innerHTML = "Start";
      $start.setAttribute("aria-pressed", false);

      if (startTime >= 600) {
        startTime -= 300;
      } else {
        startTime = 300;
      }

      remainingTime = startTime;
      originalTime = startTime;
      printTimer(formatTime(startTime));
    };

    $start.addEventListener("click", onStart);
    $reset.addEventListener("click", onReset);
    $increaseTime.addEventListener("click", onIncreaseTime);
    $decreaseTime.addEventListener("click", onDecreaseTime);
    printTimer(formatTime(remainingTime));

}());
